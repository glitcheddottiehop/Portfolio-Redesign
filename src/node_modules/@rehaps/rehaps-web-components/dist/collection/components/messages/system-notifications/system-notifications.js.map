{"version":3,"file":"system-notifications.js","sourceRoot":"","sources":["../../../../../src/components/messages/system-notifications/system-notifications.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  h,\n  Component,\n  FunctionalComponent,\n  Host,\n  State,\n  Method,\n  Element,\n  Fragment,\n  Listen,\n} from \"@stencil/core\";\nimport { SystemNotificationInterface } from \"../../../interfaces/components/messages/system-notifications/system-notifications\";\nimport CloseIcon from \"@material-design-icons/svg/round/close.svg\";\n\n/**\n * This is a component for system notifications.\n */\n@Component({\n  tag: \"rwc-system-notifications\",\n  styleUrl: \"system-notifications.scss\",\n  shadow: true,\n})\nexport class RwcSystemNotification {\n  /**\n   * The reference to the host element.\n   */\n  @Element() host!: HTMLRwcSystemNotificationsElement;\n\n  /**\n   * The reference to the notification container element.\n   */\n  private notificationContainerElement!: HTMLDivElement;\n\n  /**\n   * This state holds the notifications.\n   */\n  @State() notifications: Map<\n    SystemNotificationInterface,\n    NodeJS.Timeout | null\n  > = new Map();\n\n  /**\n   * This state is used to trigger changes.\n   */\n  @State() stateChangeTrigger: boolean = false;\n\n  /**\n   * This method gets the animation duration from the host element style.\n   */\n  private get animationDuration(): number {\n    return Number.parseInt(\n      getComputedStyle(this.host).getPropertyValue(\n        \"--system-notifications-fade-animation-duration\"\n      )\n    );\n  }\n\n  /**\n   * This method gets the close animation duration from the host element style.\n   */\n  private get heightAnimationDuration(): number {\n    return Number.parseInt(\n      getComputedStyle(this.host).getPropertyValue(\n        \"--system-notifications-height-animation-duration\"\n      )\n    );\n  }\n\n  /**\n   * Sets the max height of each of notifications wrapper to size of its content.\n   */\n  @Listen(\"resize\", { target: \"window\" })\n  onWindowResize(): void {\n    this.notificationContainerElement\n      .querySelectorAll(\".notification-wrapper\")\n      .forEach((wrapper: HTMLDivElement) => {\n        wrapper.style.maxHeight = `${wrapper.scrollHeight}px`;\n      });\n  }\n\n  /**\n   * Initialzies the timeout callbacks for any notifications existing in component.\n   */\n  public connectedCallback(): void {\n    this.notifications.clear();\n  }\n\n  /**\n   * Clears the timout callbacks.\n   */\n  public disconnectedCallback() {\n    this.notifications.forEach((timeout) => {\n      clearTimeout(timeout);\n    });\n  }\n\n  /**\n   * This method pushes a notification. Generates random key if not set.\n   * @returns {string} The notification key.\n   */\n  @Method()\n  public async pushNotification(\n    notification: SystemNotificationInterface\n  ): Promise<string> {\n    if (!notification.key) {\n      notification.key = Math.floor(\n        Math.random() * Number.MAX_SAFE_INTEGER\n      ).toString();\n    }\n\n    this.notifications.set(notification, this.initAutoRemove(notification));\n\n    if (this.forceStateChange()) {\n      await new Promise(requestAnimationFrame);\n\n      // Calculate and set the height after the browser has had a chance to render the element\n      setTimeout(() => {\n        this.updateNotificationMaxHeight(notification);\n      }, 0);\n    }\n    return notification.key;\n  }\n\n  /**\n   * This method sets notifications.\n   */\n  @Method()\n  public async setNotifications(\n    notifications: SystemNotificationInterface[]\n  ): Promise<string[]> {\n    this.clearNotifications();\n    const keys: string[] = [];\n    for (const notification of notifications) {\n      keys.push(await this.pushNotification(notification));\n    }\n\n    return keys;\n  }\n\n  /**\n   * This method removes a notification.\n   */\n  @Method()\n  public async removeNotification(index: number): Promise<void> {\n    const key = Array.from(this.notifications.keys())[index];\n    this.removeNotificationByReference(key);\n  }\n\n  /**\n   * This method clears all notifications.\n   */\n  @Method()\n  public async clearNotifications(): Promise<void> {\n    this.notifications.clear();\n    this.forceStateChange();\n  }\n\n  /**\n   * This method initializes auto removal of a notification.\n   */\n  private initAutoRemove(\n    notification: SystemNotificationInterface\n  ): NodeJS.Timeout | null {\n    this.unsetAutoRemoveByReference(notification);\n    if (notification.duration > 0) {\n      return setTimeout(() => {\n        this.removeNotificationByReference(notification);\n      }, notification.duration);\n    }\n\n    return null;\n  }\n\n  /**\n   * This method unsets auto removal of a notification by reference.\n   */\n  private unsetAutoRemoveByReference(\n    notification: SystemNotificationInterface\n  ): void {\n    const timeout = this.notifications.get(notification);\n    if (timeout !== null) {\n      clearTimeout(timeout);\n    }\n  }\n\n  /**\n   * This method removes a notification by reference.\n   */\n  private async removeNotificationByReference(\n    notification: SystemNotificationInterface\n  ): Promise<void> {\n    setTimeout(() => {\n      notification.closing = true;\n\n      if (this.forceStateChange()) {\n        setTimeout(() => {\n          this.handleNotificationRemove(notification);\n        }, Math.max(0, this.animationDuration - this.heightAnimationDuration));\n      }\n    }, 0);\n  }\n\n  /**\n   * Awaits end of closing animation and removes the notification from the list.\n   * @param notification The notification to remove.\n   */\n  private async handleNotificationRemove(\n    notification: SystemNotificationInterface\n  ): Promise<void> {\n    setTimeout(() => {\n      this.notifications.delete(notification);\n      this.forceStateChange();\n    }, Math.max(0, this.heightAnimationDuration));\n  }\n\n  /**\n   * Updates the max-height style attribute to the current height needed to render content.\n   * @param {SystemNotificationInterface} notification The notification to update the height for.\n   * @returns {HTMLElement} The html element of the notification.\n   */\n  private updateNotificationMaxHeight(\n    notification: SystemNotificationInterface\n  ): HTMLElement {\n    const notificationElement: HTMLElement = this.notificationContainerElement.querySelector(\n      `[data-key=\"${notification.key}\"]`\n    );\n\n    if (notificationElement) {\n      notificationElement.style.maxHeight = `${notificationElement.scrollHeight}px`;\n    }\n\n    return notificationElement;\n  }\n\n  /**\n   * This method forces a state change.\n   */\n  private forceStateChange(): boolean {\n    try {\n      this.stateChangeTrigger = !this.stateChangeTrigger;\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * This method renders the component.\n   */\n  public render(): FunctionalComponent {\n    return (\n      <Host>\n        <div\n          ref={(element: HTMLDivElement) =>\n            (this.notificationContainerElement = element)\n          }\n          class=\"container\"\n        >\n          {this.renderNotifications()}\n        </div>\n      </Host>\n    );\n  }\n\n  /**\n   * This method renders notifications.\n   */\n  private renderNotifications(): FunctionalComponent[] {\n    const notificationElements: FunctionalComponent[] = [];\n    for (const [notification, _timeout] of this.notifications) {\n      notificationElements.push(\n        <div\n          class={{\n            [\"notification-wrapper\"]: true,\n            closing: notification.closing,\n          }}\n          key={notification.key}\n          data-key={notification.key}\n          onMouseEnter={() => this.unsetAutoRemoveByReference(notification)}\n          onMouseLeave={() => this.initAutoRemove(notification)}\n        >\n          <div\n            class={{\n              notification: true,\n              [notification.type ?? \"info\"]: true,\n            }}\n          >\n            {this.renderCloseIcon(notification)}\n            {notification.title && <p class=\"title\">{notification.title}</p>}\n            {notification.message && (\n              <p class=\"message\">{notification.message}</p>\n            )}\n          </div>\n        </div>\n      );\n    }\n    return notificationElements;\n  }\n\n  /**\n   * This method renders the close icon for a notification.\n   */\n  private renderCloseIcon(\n    notification: SystemNotificationInterface\n  ): FunctionalComponent {\n    if (notification.closable) {\n      return (\n        <div\n          class=\"close-icon\"\n          innerHTML={CloseIcon}\n          onClick={() => this.removeNotificationByReference(notification)}\n        ></div>\n      );\n    }\n\n    return <Fragment></Fragment>;\n  }\n}\n"]}